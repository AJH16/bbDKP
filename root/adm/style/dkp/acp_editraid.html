<!-- INCLUDE overall_header.html -->
<!--
		$Id$
//-->
<a name="maincontent"></a>

<!-- IF S_EDITRAIDER -->
	<a href="{U_BACK}" style="float: {S_CONTENT_FLOW_END};">&laquo; {L_BACK}</a>

	<h1>{L_ADD_RAIDER_TITLE}</h1>
	<p>{L_ADD_RAIDER_EXPLAIN}</p>
	<form method="post" action="{F_EDIT_RAID}" name="editraid" >
	<fieldset>

 	 <dl>
	    <dt><label for="attendee_id">{L_ATTENDEE}:</label></dt>
	    <select name="attendee_id"> {S_MEMBERLIST_OPTIONS}</select> 
	 </dl>
	  <dl>
	    <dt><label for="member_earned">{L_EARNED}:</label></dt>
			<dd><input type="text" name="member_earned" size="20" maxlength="14" value="{MEMBER_EARNED}" class="input" /> 
			/ {L_SHOULD_BE}: {CORRECT_MEMBER_EARNED}</dd>
	  </dl> 
	
	  <dl>
	    <dt><label>{L_CURRENT}:</label></dt>
		<dd><span class="{C_MEMBER_CURRENT}"><strong>{MEMBER_CURRENT}</strong></span></dd>
	  </dl>

	<p class="submit-buttons">
		<input class="button1" type="submit" id="addnew" name="addnew" value="{L_SUBMIT}" />&nbsp;
		<input class="button2" type="reset" id="reset" name="reset" value="{L_RESET}" />
		{S_FORM_TOKEN}
	</p>
	</fieldset>
	</form>

<!-- ELSE -->
<!-- load the template for editing raid -->


<script type="text/javascript">
//<![CDATA[
window.onload = start;
function start()
{
	durationcalc();
}

/* gets value from event and puts it in raidvalue box */
function switch_event_val()
{
  var patt= / - \(([0-9.]+)\)/;
  var eventvalue  = document.editraid.event_id.options[document.editraid.event_id.selectedIndex].text.match(patt);
  document.editraid.raid_value.value = eventvalue[eventvalue.length-1]; 
}


/* calculates time dkp bonus from raid duration and config settings */
function durationcalc()
{
	var day = document.editraid.d.options[document.editraid.d.selectedIndex].text;
	var month = document.editraid.mo.options[document.editraid.mo.selectedIndex].text;
	var year = document.editraid.Y.options[document.editraid.Y.selectedIndex].text;
	var starth = document.editraid.sh.options[document.editraid.sh.selectedIndex].text;
	var startm = document.editraid.smi.options[document.editraid.smi.selectedIndex].text;
	var starts = document.editraid.ss.options[document.editraid.ss.selectedIndex].text;
	var raidbegin = new Date();
	raidbegin.setDate(day);
	raidbegin.setMonth(month);
	raidbegin.setYear(year);
	raidbegin.setHours(starth);
	raidbegin.setMinutes(startm);
	raidbegin.setSeconds(starts);
	
	var stoph = document.editraid.eh.options[document.editraid.eh.selectedIndex].text;
	var stopm = document.editraid.emi.options[document.editraid.emi.selectedIndex].text;
	var stops = document.editraid.es.options[document.editraid.es.selectedIndex].text;
	var raidend = new Date();
	raidend.setDate(day);
	raidend.setMonth(month);
	raidend.setYear(year);
	if(stoph<starth)
	{  /* past midnight*/
		raidend.setDate(raidend.getDate() + 1);
	}
	raidend.setHours(stoph);
	raidend.setMinutes(stopm);
	raidend.setSeconds(stops);
	
	document.editraid.ed.value = raidend.getDate;
	document.editraid.emo.value = raidend.getMonth;
	document.editraid.eY.value = raidend.getYear;

	var diff=raidend-raidbegin;
	if(diff> 0)
	{
		diff=diff/86400000*24;
		diff=diff.toFixed(2);		
		document.editraid.raid_duration.value = diff;
	}
	else
	{
		document.editraid.raid_duration.value = 0;
	}
	
	var dkp_per_timeunit = document.editraid.dkptimeunit.value;
	var unitminutes = document.editraid.timeunit.value;
	var dkp_bonus = 0;
	if(unitminutes > 0)
	{
		dkp_bonus = (dkp_per_timeunit * (diff*60) / unitminutes ).toFixed(2);
	}
	
	document.editraid.time_bonus.value = dkp_bonus;
}

//]]>
</script>

<form method="post" action="{F_EDIT_RAID}" name="editraid">
<div>
<h1>{RAIDTITLE}</h1>
<p>{L_ACP_EDITRAID_EXPLAIN}</p>

<fieldset style="background-color: #F3F3F3;">
<div style="float: left; width: 55%;">
<fieldset>

<legend>{L_EDIT_RAID_TITLE}</legend>

<input type="hidden" name="hidden_id" value="{RAID_ID}" /> 
<input type="hidden" name="hidden_dkpid" value="{EVENT_DKPID}" /> 
	<dl><dt><label>{L_POOL}:</label></dt>
	<dd><strong>{RAID_DKPPOOL}</strong></dd>
	</dl>
	
	<dl>
		<dt><label>{L_EVENT}:</label></dt>
    <dd>
	    <select name="event_id" id="event_id" onChange="javascript:switch_event_val();" >
			<!-- BEGIN events_row -->
			<option value="{events_row.VALUE}"{events_row.SELECTED}>{events_row.OPTION}</option>
			<!-- END events_row -->
		</select>
	</dd>
	</dl>		
	
	<dl>
		<dt><label>{L_DATE}:</label></dt>
		<dd>
		<select name="d">{S_RAIDDATE_DAY_OPTIONS}</select>
		<select name="mo">{S_RAIDDATE_MONTH_OPTIONS}</select> 
		<select name="Y">{S_RAIDDATE_YEAR_OPTIONS}</select>
	   </dd>
	</dl>
		<input type="hidden" name="ed" value="" /> 
		<input type="hidden" name="emo" value="" /> 
		<input type="hidden" name="eY" value="" /> 
			<dl>
		<dt><label>{L_RAIDSTART}:</label></dt>
		<dd>
			<select name="sh" onChange="javascript:durationcalc();">{S_RAIDSTART_H_OPTIONS}</select>
			<select name="smi" onChange="javascript:durationcalc();">{S_RAIDSTART_MI_OPTIONS}</select> 
			<select name="ss" onChange="javascript:durationcalc();">{S_RAIDSTART_S_OPTIONS}</select>
		</dd>
	</dl>
	<dl>
		<dt><label>{L_RAIDEND}:</label></dt>
		<dd>
			<select name="eh" onChange="javascript:durationcalc();">{S_RAIDEND_H_OPTIONS}</select>
			<select name="emi" onChange="javascript:durationcalc();">{S_RAIDEND_MI_OPTIONS}</select> 
			<select name="es" onChange="javascript:durationcalc();">{S_RAIDEND_S_OPTIONS}</select>
		</dd>
	</dl>
		
	<dl>
		<dt><label>{L_RAIDDURATION}:</label>({L_RAIDDURATION_EXPLAIN})</dt>
		<dd>
			<input readonly="readonly" type="text" name="raid_duration" id="raid_duration" size="8" maxlength="7" value="{RAID_DURATION}" class="input" style="border: none" />
		</dd>
	</dl>
	
	<dl>
		<dt><label>{L_RAIDVALUE}:</label>({L_ADD_RAID_VALUE_NOTE})</dt>
		<dd>
			<input type="text" name="raid_value" id="raid_value" size="8" maxlength="7" value="{INDIVIDUAL_RAID_VALUE}" class="input" />
		</dd>
	</dl>

	<input type="hidden" name="dkptimeunit" value="{DKPTIMEUNIT}" /> 
	<input type="hidden" name="timeunit" value="{TIMEUNIT}" /> 
	<dl>
		<dt><label>{L_TIME_BONUS}:</label>&nbsp;{L_TIME_BONUS_EXPLAIN}&nbsp;{DKPPERTIME}</dt>
		<dd>
			<input type="text" name="time_bonus" id="time_bonus" size="8" maxlength="7" value="{TIME_BONUS}" class="input" />
		</dd>
	</dl>
	 <dl>
       <dt><label for="overridetime_bonus">{L_OVERRIDE}</label>{L_TIME_OVERRIDE}</dt>
        <dd>
        	<input type="checkbox" name="overridetime_bonus" value="1"/>
        </dd>
  	</dl>
	
</fieldset>
</div>

<div style="float: left; width: 45%;">

<fieldset>
<legend>{L_NOTE}</legend>
	<textarea name="raid_note" cols="60" rows="12" wrap="soft">{RAID_NOTE}</textarea>
</fieldset>

<!-- IF S_SHOWADDATTENDEE -->
<fieldset>
<legend>{L_ADD_RAIDER_TITLE}</legend>
 	 <dl>
	    <dt><label for="attendee_id">{L_MEMBER}:</label>{L_ATTENDEEADD_EXPLAIN}</dt>
	    <dd><select name="attendee_id">&nbsp;{S_MEMBERLIST_OPTIONS}</select></dd> 
	 </dl>
	 
	 
<fieldset class="quick" style="float: {S_CONTENT_FLOW_END};">
	<input type="submit" name="addattendee" value="{L_ADD_ATTENDEE}" class="button1" />
</fieldset>
</fieldset>
<!-- ENDIF -->


</div>


<div style="clear: both; width: 100%;">
<fieldset>
<legend>{L_ATTENDEES}</legend>
<table cellspacing="1">
<thead>
  <tr>
    <th style="text-align:left;" width="30%"><a href="{F_EDIT_RAID}&amp;o={O_NAME}&amp;">{L_NAME}</a></th>
    <th style="text-align:right;" width="15%" width="30" nowrap="nowrap"><a href="{F_EDIT_RAID}&amp;o={O_RAIDVALUE}">{L_RAIDVALUE}</a></th>
    <th style="text-align:right;" width="15%" width="30" nowrap="nowrap"><a href="{F_EDIT_RAID}&amp;o={O_TIMEVALUE}">{L_TIMEVALUE}</a></th>
    <th style="text-align:right;" width="15%" width="30" nowrap="nowrap"><a href="{F_EDIT_RAID}&amp;o={O_ZSVALUE}">{L_ZSVALUE}</a></th>
    <th style="text-align:right;" width="15%" nowrap="nowrap"><a href="{F_EDIT_RAID}&amp;o={O_DECAYVALUE}">{L_DECAY}</a></th>
    <th style="text-align:right;" width="15%" nowrap="nowrap"><a href="{F_EDIT_RAID}&amp;o={O_TOTALVALUE}">{L_TOTAL}</a></th>
    <th style="text-align:center;" width="5">{L_ACTION}</th>
  </tr>
  </thead>
<tbody>
  <!-- BEGIN raids_row -->
  <!-- IF raids_row.S_ROW_COUNT is even --><tr class="row1"><!-- ELSE --><tr class="row2"><!-- ENDIF -->
    <td style="text-align:left;" width="30%"><a href="{raids_row.U_VIEW_ATTENDEE}">{raids_row.NAME}</a></td>
    <td style="text-align:right;" width="15%" class="positive">{raids_row.RAIDVALUE}</td>
    <td style="text-align:right;" width="15%" class="positive">{raids_row.TIMEVALUE}</td>
    <td style="text-align:right;" width="15%" class="positive">{raids_row.ZSVALUE}</td>
    <td style="text-align:right;" width="15%" class="negative">{raids_row.DECAYVALUE}</td>
    <td style="text-align:right;" width="15%" class="positive">{raids_row.TOTAL}</td>
    <td style="text-align:center;"  width="5" nowrap="nowrap">
		<a href="{raids_row.U_EDIT_ATTENDEE}">{ICON_EDIT}</a>&nbsp;
		<a href="{raids_row.U_DELETE_ATTENDEE}">{ICON_DELETE}</a>
	</td>
	
  </tr>
  <!-- END raids_row -->
  </tbody>
<tfoot>
  <tr>
    <th class="footer">{LISTRAIDS_FOOTCOUNT}</th>
    <th class="footer" style="text-align:right;" width="15%" width="30" nowrap="nowrap">{RAID_VALUE}</th>
    <th class="footer" style="text-align:right;" width="15%" width="30" nowrap="nowrap">{TIMEVALUE}</th>
    <th class="footer" style="text-align:right;" width="15%" width="30" nowrap="nowrap">{ZSVALUE}</th>
    <th class="footer" style="text-align:right;" width="15%" nowrap="nowrap">{DECAYVALUE}</th>
    <th class="footer" style="text-align:right;" width="15%" nowrap="nowrap">{TOTAL}</th>
    <th></th>
  </tr>
  </tfoot>
</table>

</fieldset>
</div>

</fieldset>
</div>
{S_FORM_TOKEN}
<fieldset class="quick" style="float: {S_CONTENT_FLOW_BEGIN};">
	<input type="submit" name="delete" value="{L_DELETE_RAID}"	class="button1" />
</fieldset>
<fieldset class="quick" style="float: {S_CONTENT_FLOW_END};">
	<input type="submit" name="update" value="{L_UPDATE_RAID}" class="button1" />
	<input type="submit" name="additem" value="{L_ADD_ITEM}" class="button1" />
</fieldset>


</form>
<!-- ENDIF -->

<!-- INCLUDE dkp/overall_footer.html -->
